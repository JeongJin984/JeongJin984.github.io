---
title: Spring JPA 2
author: Jiny
date: 2021-01-24 17:16:00 +0800
categories: [Java, Spring]
tags: [java, spring, jpa]
toc: false
---

# Spring JPA 2
___

## ğŸ’¿ Entity Mapping

### @Entity

- EntityëŠ” ê°ì²´ ê´€ì ì—ì„œ ë¶€ë¥´ëŠ” ì´ë¦„
- ë³´í†µ Classì™€ ê°™ì€ ì´ë¦„ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ê°’ì„ ë³€ê²½í•˜ì§€ ì•ŠìŒ
- Entityì˜ ì´ë¦„ì€ JQLì—ì„œ ì‚¬ìš©

### @Table

- Relation(database) ê´€ì ì—ì„œ ë¶€ë¥´ëŠ” ì´ë¦„
- @Entityì˜ ì´ë¦„ì´ ê¸°ë³¸ê°’
- Tableì˜ ì´ë¦„ì€ SQLì—ì„œ ì‚¬ìš©

### @Id

- Entityì˜ Primary Keyë¥¼ ë§¤í•‘í•  ë–„ ì‚¬ìš©
- javaì˜ ëª¨ë“  primitive ì™€ Wrapper íƒ€ì… ì‚¬ìš© ê°€ëŠ¥
  - Dateë‘ BigDecimal, BigIntegerë„ ì‚¬ìš©ê°€ëŠ¥
- ë³µí•©í‚¤ë¥¼ ë§Œë“¤ì–´ ë§¤í•‘í•˜ëŠ” ë°©ë²•ë„ ìˆê¸´ ìˆìŒ

### @GenerativeValue

- Primary Keyì˜ ìƒì„± ë°©ë²•ì„ ë§¤í•‘í•˜ëŠ” Annotation
- ìƒì„± ì „ëµê³¼ ìƒì„±ê¸°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŒ
  - ê¸°ë³¸ ì „ëµ: AUTO(DBì— ë”°ë¼ ì ì ˆí•œ ì „ëµ ì„ íƒ)
  - TABLE, SEQUENCE, IDENTITY ì¤‘ í•˜ë‚˜

### @Column

- unique, nullable, length, ColumnDefinition ë“± Rowì˜ íŠ¹ì„± ì •ì˜

### @Temporal

- Date ì™€ Calendar 

### @Transient

- Columnìœ¼ë¡œ ë§¤í•‘í•˜ê³  ì‹¶ì§€ ì•Šì€ ë©¤ë²„ ë³€ìˆ˜ì— ì‚¬ìš©

**Tip**

- spring.jpa.show-sql=true
- spring.jpa.properties.hibernate.format_sql=true

___

## ğŸ’¿ @Value íƒ€ì… ë§¤í•‘

### Entity ì™€ Value

- ì‹ë³„ìê°€ ìˆì–´ì•¼ í•˜ëŠ”ê°€
- ë…ë¦½ì ìœ¼ë¡œ ì¡´ì¬í•´ì•¼ í•˜ëŠ”ê°€

### Value íƒ€ì… ì¢…ë¥˜

- ê¸°ë³¸ íƒ€ì…(String, Date, Boolean)
- Composite Value íƒ€ì…
- Collection Value íƒ€ì…
  - ê¸°ë³¸ íƒ€ì…ì˜ ì½œë ‰ì…˜
  - Composite íƒ€ì…ì˜ ì½œë ‰ì…˜

### Composite Value íƒ€ì…

- @Embedable
- @Embedded
- @AttributeOverrides
- AttributeOverride

___

## ğŸ’¿ ê´€ê³„ ë§¤í•‘

- 2ê°œì˜ Entityì˜ ê´€ê³„ë¥¼ ì„¤ì •
  - ë‘˜ ì¤‘ í•˜ë‚˜ëŠ” ê´€ê³„ì˜ ì£¼ì¸ì´ ë˜ì–´ì•¼ í•¨
  - ë‹¤ë¥¸ ìª½ì€ ì¢…ì†ëœ ìª½
  - í•´ë‹¹ ê´€ê³„ì˜ ë°˜ëŒ€ìª½ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ê°€ì§„ ìª½ì´ ì£¼ì¸

- ë‹¨ë°©í–¥
  - ë‹¨ë°©í–¥ì—ì„œëŠ” ê´€ê³„ì˜ ì£¼ì¸ì´ ëª…í™•
    - ê´€ê³„ë¥¼ ì •ì˜í•œ ìª½ì´ ê´€ê³„ì˜ ì£¼ì¸
  - ë‹¨ë°©í–¥ @ManyToOne
    - ê¸°ë³¸ê°’ì€ FK ìƒì„±
  - ë‹¨ë°©í–¥ @OneToMany
    - ê¸°ë³¸ê°’ì€ ì¡°ì¸ í…Œì´ë¸” ìƒì„±
  
- ì–‘ë°©í–¥
  - FKë¥¼ ê°€ì§€ê³  ìˆëŠ” ìª½ì´ Owner ë”°ë¼ì„œ @ManytoOne ê°€ì§€ê³  ìˆëŠ” ìª½ì´ ì£¼ì¸
  - ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ mappedbyë¥¼ í†µí•´ í•„ë“œë¥¼ ì„¤ì •	
    - @ManyToOne(ì´ìª½ì´ ì£¼ì¸)
    - @OneToMany(mappedby)
    - ì£¼ì¸ì—ê²Œ ê´€ê³„ë¥¼ ì„¤ì •í•´ì•¼ DBì— ë°˜ì˜ì´ ë¨(ì¤‘ìš”)
      - mappedbyìª½ì— ë”í•´ì„œ saveí•´ë„ DB ì ìš© ì•ˆë¨

___

## ğŸ’¿ Entity ìƒíƒœì™€ Cascade

> Cascade: Entityì˜ ìƒíƒœë¥¼ ì „ì´ ì‹œí‚¤ëŠ” ì˜µì…˜

### Entityì˜ ìƒíƒœ

- Transient: JPAê°€ ëª¨ë¥´ëŠ” ìƒíƒœ
- Persistent: JPAê°€ ê´€ë¦¬ì¤‘ì¸ ìƒíƒœ(1ì°¨ ìºì‰¬, Dirty-Checking, WriteBehind)
- Detached: JPAê°€ ë”ì´ìƒ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ìƒíƒœ
- Removed: JPAê°€ ê´€ë¦¬í•˜ê¸´ í•˜ì§€ë§Œ ì‚­ì œí•˜ê¸°ë¡œ í•œ ìƒíƒœ

![image](https://blog.kakaocdn.net/dn/biYa6T/btqCuYYCtXY/Bxqa5rHj3s4Rz33PQDmJFK/img.jpg)

___

## Entity Fetch Join

- ì—°ê´€ëœ Entityë¥¼ í•¨ê»˜ ì¡°íšŒ
- select m from Member m join fetch m.team
  - SQL: Select M.*,T.* FROM MEMBER M INNER JOIN TEAM T on M.TEAM_ID=T.ID