---
title: Golang Slice
author: Jiny
date: 2021-09-03 12:40:00 +0800
categories: [Network, TLS]
tags: [tls, ssl, network]
toc: false
---

# SSL / TLS
___

## π’Ώ **SSL / TLS**

![image](https://www.thesslstore.com/blog/wp-content/uploads/2018/03/TLS_1_3_Handshake.jpg)

- SSL: Secure Sockets Layer(Netscapeμ‚¬μ—μ„ κ°λ°)
- TLS: Transport Layer Security


## π’Ώ **Certificate λ³΄μ¥**

![image](https://docs.pexip.com/Resources/Images/admin_guide/TLS_certification_process3_700x372.png)

- λ¨Όμ € μ„λ²„μΈ΅μ— μΈμ¦μ„κ°€ ν•„μ”ν•¨
  - μ΄ μΈμ¦μ„ λ°κΈ‰μ„ μ„ν•΄μ„ key(κ³µκ°ν‚¤, κ°μΈν‚¤)λ¥Ό λ§λ“¤μ–΄μ•Ό ν•¨
	- κ³µκ°ν‚¤(csr)λ¥Ό CAκΈ°κ΄€μ— λ³΄λ‚΄λ©΄ κ³µκ°ν‚¤μ™€ μΈμ¦μ„(crt)λ¥Ό λ¬¶μ–΄μ„ λ³΄λ‚΄μ¤
- Clientκ°€ μ„λ²„ μ ‘μ†μ‹ μΈμ¦μ„λ¥Ό μ”κµ¬
  - Serverκ°€ μΈμ¦μ„μ™€ κ³µκ°ν‚¤λ¥Ό λ³΄λƒ„
- Clientκ°€ CAκΈ°κ΄€μ— μΈμ¦μ„λ¥Ό ν™•μΈ μ”μ²­
- CAκΈ°κ΄€μ ν™•μΈμ΄ μ™„λ£λλ©΄ μ•”νΈν™”λ session keyλ¥Ό λ³΄λƒ„
  - ν†µμ‹ ν• λ• λ§λ‹¤ κ³µκ°ν‚¤λ¥Ό μ‚¬μ©ν•λ©΄ resourceλ¥Ό λ„λ¬΄ λ§μ΄ μ΅μ•„λ¨Ήμ(κ³µκ°ν‚¤λ” λ§μ΄ κΈΈλ‹¤)
  - κ·Έλμ„ μ²μ ν†µμ‹ ν•  λ•λ§ session keyλ¥Ό κ³µκ°ν‚¤λ΅ μ•”νΈν™” ν•΄μ„ μ‚¬μ©
- μ΄μ  μ΄ session keyλ΅ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•΄μ„ μ‚¬μ©ν•¨ 
___

## π’Ώ **λ™μ‘**

![image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fn0FfA%2FbtqE4q7GyzR%2F9c0n2IZbrzwmvDMb11CF11%2Fimg.png)

### **1> Client Hello**

> Clientκ°€ μ„λ²„μ— μ ‘μ†μ„ μ‹λ„ν• λ• ν•λ” μ²«λ²μ§Έ μΈμ‚¬

- random: Clientλ” 32 λ°”μ΄νΈ λ‚μκ°’μ„ μ „λ‹¬
  - λ‚μ¤‘μ— λΉ„λ°€ λ°μ΄ν„°(master secret)λ¥Ό μ„ν•΄ μ‚¬μ©λ¨ 
- session ID: μ„Έμ…μ„ μ²μ μƒμ„±ν• λ•λ” λΉκ°’, μ΄λ―Έ μƒμ„±λ μ„Έμ…μ΄ μλ‹¤λ©΄ κ·Έ μ„Έμ… IDλ¥Ό μ „λ‹¬
- cipher suit: ν΄λΌμ΄μ–ΈνΈκ°€ μ§€μ›κ°€λ¥ν• ν‚¤ κµν™ μ•κ³ λ¦¬μ¦, λ€μΉ­ν‚¤ μ•”νΈ μ•κ³ λ¦¬μ¦ λ“±μ„ μ•λ ¤μ¤
  - ν‚¤κµν™μ€ RSA, λ€μΉ­ν‚¤λ” AES_128 GCMλ°©μ‹λ“±μ„ μ‚¬μ©

### **2> Server Hello**

> μ‚¬μ©ν•  TLSλ²„μ „, Client, μ„λ²„ κ³µν†µμΌλ΅ μ§€μ›κ°€λ¥ν• Cipher suite, μ••μ¶•λ°©μ‹λ“±μ„ clientμ— μ „λ‹¬

- random: μ„λ²„λ„ 32byte λ‚μλ¥Ό clientμ— μ „λ‹¬
  - μ΄ μ—­μ‹ master secretμ΄λΌλ” λΉ„λ°€ κ°’μ„ μƒμ„±ν•  λ• μ‚¬μ©
- session ID: μ„Έμ… μ •λ³΄

### **3> server certificate**

> μ—¬κΈ°μ„ μΈμ¦μ„λ¥Ό μ΄μ©ν•΄μ„ ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„κ°€ λ―Ώμ„ λ§ν• μ„λ²„μΈμ§€ ν™•μΈν•λ‹¤.(Certificate λ³΄μ¥ λ¶€λ¶„)

### **4> Server key exchange**

> ν‚¤ κµν™μ— ν•„μ”ν• μ •λ³΄λ¥Ό μ κ³µν•©λ‹λ‹¤.

- ν•„μ”ν•μ§€ μ•μΌλ©΄ μ΄ κ³Όμ •μ„ μƒλµμ΄ κ°€λ¥
  - μλ¥Ό λ“¤μ–΄ ν‚¤κµν™ μ•κ³ λ¦¬μ¦μ΄ Diffie-HellmanμΌλ΅ μ‚¬μ©ν•λ‹¤λ©΄ μ†μ, μ›μ‹κ·Ό λ“±μ΄ ν•„μ”ν•¨

### **5> Certificate request**

> μ„λ²„ μ—­μ‹ ν΄λΌμ΄μ–ΈνΈλ¥Ό μΈμ¦ν•΄μ•Όν•  λ• μΈμ¦μ„λ¥Ό μ”κµ¬ν•  μ μμµλ‹λ‹¤.

- ν•„μ” μ μ°¨λ” μ•„λ‹

### **6> Server Hello Done**

> μ„λ²„μ μΈμ‚¬κ°€ λλ‚¨

### **7> Certificate**

> λ°©κΈ μ „ μ„λ²„κ°€ μ”μ²­ν–λ μΈμ¦μ„λ¥Ό μ¤„ μ μμµλ‹λ‹¤. 

- μ„λ²„κ°€ μ”μ²­ν•μ§€ μ•μ•μΌλ©΄ μƒλµλ¨

### **8> Client key exchange**

> ν‚¤ κµν™μ— ν•„μ”ν• μ •λ³΄(pre-master-secret)λ¥Ό μ„λ²„μ— μ κ³µ

- μ λ€ λ…Έμ¶λμ–΄μ„λ” μ•λ¨
- μ„λ²„λ΅ λ°›μ€ random κ°’μ„ μ¬λ£λ΅ ν΄λΌμ΄μ–ΈνΈκ°€ μƒμ„±ν• λλ¤κ°’μ„ μ΅°ν•©ν•μ—¬ μ„λ²„μ— μ „μ†΅
  - μ΄ μ •λ³΄λ” μΈμ¦μ„μ•μ κ³µκ°ν‚¤λ΅ μ•”νΈν™” ν•΄μ„ μ „μ†΅ν•λ‹¤.
  - μ•”νΈν™”λ μ •λ³΄λ¥Ό μ„λ²„κ°€ κ°μΈν‚¤λ΅ λ³µνΈν™” ν•λ‹¤.
  - μ΄μ  κ³µμ ν•κ³  μλ” pre-master secretμ„ μΌλ ¨μ κ³Όμ •μ„ κ±°μ³ master secretμΌλ΅ λ§λ“¬
  - μ΄ ν‚¤λ¥Ό λ€μΉ­ν‚¤λ΅ μ‚¬μ©

### **9> Certificate verify**

> ν΄λΌμ΄μ–ΈνΈμ— λ€ν• Certificate requestλ¥Ό λ°›μ•λ‹¤λ©΄ λ³΄λ‚Έ μΈμ¦μ„μ— λ€ν• κ°μΈν‚¤λ¥Ό κ°€μ§€κ³  μλ‹¤λ” κ²ƒμ„ μ¦λ…

- handshake κ³Όμ •μ—μ„ μ£Όκ³  λ°›μ€ λ©”μ‹μ§€ + master secretμ„ μ΅°ν•©ν• hashκ°’μ— κ°μΈν‚¤λ΅ λ””μ§€ν„Έ μ„λ…ν•μ—¬ μ „μ†΅

### **10> Change cipher spec**

> ν‘μƒλ λ³΄μ• νλΌλ―Έν„°λ¥Ό μ μ©ν•κ±°λ‚ λ³€κ²½λ λ• μ„λ²„μ—κ² μ•λ¦½λ‹λ‹¤.

### **11> Client Finished**

> ν΄λΌμ΄μ–ΈνΈ λ

### **12> change cipher spec**

> ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄μ• νλΌλ―Έν„° λ³€κ²½μ„ μ•λ¦½λ‹λ‹¤.

### **13> Finished**

> μ„λ²„λ„ λ

