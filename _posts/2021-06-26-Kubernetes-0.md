---
title: Kubernetes 0
author: Jiny
date: 2021-06-26 14:30:00 +0800
categories: [Infra, Kubernetes]
tags: [k8s, kubernetes, infra]
toc: false
---
 
# Kubernetes 0

___

## ğŸ’¿ **ë„ì»¤ ì»¨í…Œì´ë„ˆì™€ ê°€ìƒë¨¸ì‹ **

> ê°€ìƒë¨¸ì‹ : ìš´ì˜ì²´ì œ ìœ„í—¤ í•˜ë“œì›¨ì–´ë¥¼ ì—ë®¬ë ˆì´ì…˜í•˜ê³  ê·¸ ìœ„ì— ìš´ì˜ì²´ì œë¥¼ ì˜¬ë¦¬ê³  í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰

> ì»¨í…Œì´ë„ˆ: í•˜ë“œì›¨ì–´ ì—ë®¬ë ˆì´ì…˜ ì—†ì´ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì„ ê³µìœ í•´ì„œ ë°”ë¡œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰

```Bash
$ docker version
Client: Docker Engine - Community
 Version:           19.03.5
  ...

$ docker run -it ubuntu:latest bash
root@bfccfb4136ae:/# uname -a
Linux f44e33a332f2 4.15.0-70-generic #79-Ubuntu SMP Tue Nov 12 10:36:11 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux

root@bfccfb4136ae:/# cat /etc/*-release
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=18.04
DISTRIB_CODENAME=bionic
DISTRIB_DESCRIPTION="Ubuntu 18.04.3 LTS"
...
```

```bash
$ docker run -it centos:latest bash
[root@bb0a9b851dbd /]# uname -a
Linux bb0a9b851dbd 4.15.0-70-generic #79-Ubuntu SMP Tue Nov 12 10:36:11 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux

[root@bb0a9b851dbd /]# cat /etc/*-release
CentOS Linux release 8.0.1905 (Core)
NAME="CentOS Linux"
VERSION="8 (Core)"
```

ìœ„ì˜ 2ê°œì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´

- catë¥¼ í†µí•´ íŒŒì¼ì‹œìŠ¤í…œ(ë°°í¬íŒ)ì´ ë‹¤ë¦„
- uname -aì˜ ì¶œë ¥ ê²°ê³¼ê°€ ê°™ìŒ(ì»¤ë„ì´ ê°™ë‹¤)
  - ë‘˜ë‹¤ Utuntu 18.04 Vagrant ê°€ìƒë¨¸ì‹ ì—ì„œ ì‹¤í–‰

**ì´ë¥¼ í†µí•´**

- ë„ì»¤ ë°ìŠ¤í¬íƒ‘ì€ ë¦¬ëˆ…ìŠ¤í‚· ê¸°ë°˜ì˜ ê²½ëŸ‰ ê°€ìƒë¨¸ì‹  ìœ„ì—ì„œ ë„ì»¤ë¥¼ ì‹¤í–‰
- ì»¨í…Œì´ë„ˆëŠ” í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ ì»¤ë„ì„ ì‚¬ìš©í•œë‹¤.
- ì»¨í…Œì´ë„ˆëŠ” ì´ë¯¸ì§€ì— ë”°ë¼ì„œ ì‹¤í–‰ë˜ëŠ” í™˜ê²½ì´ ë‹¬ë¼ì§„ë‹¤.

ì»¨í…Œì´ë„ˆê°€ ì„œë¡œ ë‹¤ë¥¸ íŒŒì¼ ì‹œìŠ¤í…œì„ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ì´ìœ ëŠ” ì´ë¯¸ì§€(íŒŒì¼ì˜ ì§‘í•©)ë¥¼ ë£¨íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œìœ¼ë¡œ ê°•ì œë¡œ ì¸ì‹ì‹œì¼œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•˜ê¸° ë•Œë¬¸(ì¦‰ ìì‹ ì˜ ë£¨íŠ¸ /ê°€ ì•„ë‹Œ ê·¸ ì•„ë˜ì˜ íŠ¹ì • ë””ë ‰í„°ë¦¬ë¥¼ ë£¨íŠ¸ë¡œ ì¸ì‹)

___

## ğŸ’¿ **ë„ì»¤ ì»¨í…Œì´ë„ˆì™€ í”„ë¡œì„¸ìŠ¤**

> ë„ì»¤ ì»¨í…Œì´ë„ˆëŠ” ê°€ìƒë¨¸ì‹ ì´ ì•„ë‹ˆê³  í”„ë¡œì„¸ìŠ¤ë‹¤.

```bash
$ echo $$
5673

$ docker run -it ubuntu:latest bash
root@9a09675d42ed:/# echo $$
1
```

ì¼ë°˜ì ìœ¼ë¡œ 1ë²ˆ í”„ë¡œì„¸ìŠ¤ëŠ” pstreeì—ì„œ í™•ì¸í•´ ë³´ë©´ ëª¨ë“  í”„ë¡œì„¸ìŠ¤ê°€ ë¬¼ë ¤ìˆëŠ” í”„ë¡œì„¸ìŠ¤

**ì»¨í…Œì´ë„ˆ?**

> ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì— í¬í•¨ëœ í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬ ê¸°ìˆ ë“¤ì„ ì‚¬ìš©í•´ì„œ ìƒì„±ëœ íŠ¹ë³„í•œ í”„ë¡œì„¸ìŠ¤

```bash
root@47672c55680d:/# kill -9 1
root@47672c55680d:/#
```

_1ë²ˆ í”„ë¡œì„¸ìŠ¤ëŠ” ì›ë˜ ì£½ì¼ìˆ˜ë„ ì—†ë‹¤._

ìœ„ì™€ ê°™ì€ ì‚¬ì‹¤ì— ë¹„ì¶”ì–´ ë³¼ë•Œ ê·¸ëŸ¬ë©´ ì–´ë–»ê²Œ 1ë²ˆ í”„ë¡œì„¸ìŠ¤ê°€ 2ê°œì¼ ìˆ˜ ìˆëƒ?(ë„ì»¤ëŠ” 1ë²ˆì„ ì£½ì¼ìˆ˜ ìˆê³  hostì˜ 1ë²ˆì„ ì£½ì¼ ìˆ˜ ì—†ë‹¤.)
- ë¦¬ëˆ…ìŠ¤ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë•Œë¬¸
- PID ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ë¶„ë¦¬ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— 1ë²ˆì´ ë¨

___

## ğŸ’¿ **Namespace**

**1ë²ˆ**

```Bash
$ echo $$
5673

$ mkdir busybox-image
$ docker run --name busybox-image busybox:latest
$ docker export busybox-image > ./busybox-image/image.tar
$ cd busybox-image; tar xf image.tar; cd ..
$ sudo unshare -p -f --mount-proc chroot ./busybox-image /bin/sh
/ # echo $$
1
```

**2ë²ˆ**

```Bash
$ sudo unshare -p /bin/sh
# echo $$
2170
```
- 2ë²ˆì§¸ëŠ” unshareë¥¼ í†µí•´ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¶„ë¦¬í•˜ë”ë¼ë„ í˜¸ìŠ¤íŠ¸ì˜ íŒŒì¼ ì‹œìŠ¤í…œì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³  ìˆì–´ì„œ PID ê´€ë ¨ ì •ë³´ëŠ” /proc ì•„ë˜ì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸
- ê·¸ë˜ì„œ --mount-procìœ¼ë¡œ /procì„ ë¶„ë¦¬í•˜ê³  ë…ìì ì¸ í™˜ê²½ì„ ìœ„í•´ ì´ë¯¸ì§€(busybox-image)ë¥¼ ì‚¬ìš©

### 2ê°œì˜ PID

1. í”„ë¡œì„¸ìŠ¤ê°€ ë°”ë¼ë³´ëŠ” PID
2. í˜¸ìŠ¤íŠ¸ê°€ ë°”ë¼ë³´ëŠ” PID

2ë²ˆì„ ì‹¤í–‰í•´ì„œ í”„ë¡œì„¸ìŠ¤ë¥¼ ë³´ë©´

```bash
$ ps aux --sort +start_time | tail -n 5
root      2376  0.0  0.1  21472  3700 pts/0    S    03:49   0:00 bash
root      2386  0.0  0.0   7456   732 pts/0    S    03:49   0:00 unshare -p -f --mount-proc chroot ./busybox-image /bin/sh
root      2387  0.0  0.0   1312     4 pts/0    S+   03:49   0:00 /bin/sh
vagrant   2396  0.0  0.1  37516  3480 pts/1    R+   03:50   0:00 ps aux --sort +start_time
vagrant   2397  0.0  0.0   7508   856 pts/1    S+   03:50   0:00 tail -n 5
```

- ì´ë ‡ê²Œ ë‚˜ì˜¤ëŠ”ë° 2387ì„ ì£½ì´ë©´ sh unshareë¡œ ì‹¤í–‰ëœ shë„ ê°™ì´ ì¢…ë£Œë¨
- ë‘˜ì´ ê°™ì€ í”„ë¡œì„¸ìŠ¤ì´ê¸° ë•Œë¬¸
- ì¦‰ í”„ë¡œì„¸ìŠ¤ê°€ ë³´ê¸°ì—ëŠ” ìì‹ ì˜ PIDê°€ 1ë²ˆì´ì§€ë§Œ í˜¸ìŠ¤íŠ¸ ì…ì¥ì—ì„œëŠ” 2387ì´ë¼ëŠ” ëœ»

___

## ğŸ’¿ ë„ì»¤ ì»¨í…Œì´ë„ˆì™€ í”„ë¡œì„¸ìŠ¤

```bash
$ diff \
  <(ls -Al /proc/1/ns | awk '{ print $9 $10 $11 }') \
  <(ls -Al /proc/2899/ns | awk '{ print $9 $10 $11 }')

3,7c3,7
< ipc->ipc:[4026531839]
< mnt->mnt:[4026531840]
< net->net:[4026531993]
< pid->pid:[4026531836]
< pid_for_children->pid:[4026531836]
---
> ipc->ipc:[4026532238]
> mnt->mnt:[4026532236]
> net->net:[4026532298]
> pid->pid:[4026532239]
> pid_for_children->pid:[4026532239]
9c9
< uts->uts:[4026531838]
---
> uts->uts:[4026532237]
```

- ipc, mnt, net, pid, pid_for_children, uts ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ë‹¤ë¥´ì§€ë§Œ psë¡œ ì¼ë°˜ì ì¸ í”„ë¡œì„¸ìŠ¤ë¼ëŠ” ê²ƒì„ í•œ ë²ˆ í™•ì¸ ê°€ëŠ¥

## **ì»¨í…Œì´ë„ˆëŠ” íŠ¹ë³„í•œ í”„ë¡œì„¸ìŠ¤ë‹¤~~~ ì´ë§ì´ì•¼~!**

___


https://www.44bits.io/ko/post/is-docker-container-a-virtual-machine-or-a-process#%EB%8F%84%EC%BB%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EA%B0%80-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%BB%A4%EB%84%90%EA%B3%BC-%ED%8C%8C%EC%9D%BC-%EC%8B%9C%EC%8A%A4%ED%85%9C-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0)