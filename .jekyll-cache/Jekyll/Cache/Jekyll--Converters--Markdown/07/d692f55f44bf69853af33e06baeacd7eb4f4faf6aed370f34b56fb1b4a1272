I"8<h1 id="operation-system-2í”„ë¡œì„¸ìŠ¤-2">Operation System 2(í”„ë¡œì„¸ìŠ¤ 2)</h1>
<hr />

<h2 id="-system-call">ğŸ’¿ <strong>System Call</strong></h2>

<blockquote>
  <p>fork(), exec(), wait()ì™€ ê°™ì€ Processë¥¼ ìƒì„±, ì‹¤í–‰, ì œì–´í•˜ê¸° ìœ„í•œ í•¨ìˆ˜</p>
</blockquote>

<ul>
  <li>fork, execëŠ” ìƒˆë¡œìš´ Processs ìƒì„±ê³¼ ê´€ë ¨ì´ ìˆë‹¤.</li>
  <li>waitëŠ” Process(Parent)ê°€ ë§Œë“  ë‹¤ë¥¸ Process(Child)ê°€ ëë‚  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ëª…ë ¹ì–´</li>
</ul>

<h3 id="fork"><strong>fork</strong></h3>

<p><strong>ì½”ë“œ</strong></p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td> --><td class="rouge-code"><pre><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"pid : %d"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">getpid</span><span class="p">());</span> <span class="c1">// pid : 29146</span>
    
    <span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>					<span class="c1">// ì£¼ëª©</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>									<span class="c1">// (1) fork ì‹¤íŒ¨</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>					<span class="c1">// (2) child ì¸ ê²½ìš° (fork ê°’ì´ 0)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"child (pid : %d)"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">getpid</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>								<span class="c1">// (3) parent case</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"parent of %d (pid : %d)"</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">getpid</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ê²°ê³¼</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> --><td class="rouge-code"><pre>pid : 29146
parent of 29147 (pid : 29146)
child (pid : 29147)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>PID : í”„ë¡œì„¸ìŠ¤ ì‹ë³„ì. UNIX ì‹œìŠ¤í…œì—ì„œëŠ” PIDëŠ” í”„ë¡œì„¸ìŠ¤ì—ê²Œ ëª…ë ¹ì„ í•  ë•Œ ì‚¬ìš©í•¨.</p>

<p>Fork()ê°€ ì‹¤í–‰ë˜ëŠ” ìˆœê°„. í”„ë¡œì„¸ìŠ¤ê°€ í•˜ë‚˜ ë” ìƒê¸°ëŠ”ë°, ì´ ë•Œ ìƒê¸´ í”„ë¡œì„¸ìŠ¤(Child)ëŠ” forkë¥¼ ë§Œë“  í”„ë¡œì„¸ìŠ¤(Parent)ì™€ (almost) ë™ì¼í•œ ë³µì‚¬ë³¸ì„ ê°–ê²Œ ëœë‹¤. ì´ ë•Œ OSëŠ” ìœ„ì™€ ë˜‘ê°™ì€ 2ê°œì˜ í”„ë¡œê·¸ë¨ì´ ë™ì‘í•œë‹¤ê³  ìƒê°í•˜ê³ , fork()ê°€ returnë  ì°¨ë¡€ë¼ê³  ìƒê°í•œë‹¤. ê·¸ ë•Œë¬¸ì— ìƒˆë¡œ ìƒì„±ëœ Process (child)ëŠ” mainì—ì„œ ì‹œì‘í•˜ì§€ ì•Šê³ , if ë¬¸ë¶€í„° ì‹œì‘í•˜ê²Œ ëœë‹¤.</p>

<p>ê·¸ëŸ¬ë‚˜, ì°¨ì´ì ì´ ìˆì—ˆë‹¤. ë°”ë¡œ childì™€ parentì˜ fork() ê°’ì´ ë‹¤ë¥´ë‹¤ëŠ” ì ì´ë‹¤. ë”°ë¼ì„œ, ì™„ì „íˆ ë™ì¼í•œ ë³µì‚¬ë³¸ì´ë¼ í•  ìˆ˜ ì—†ë‹¤.</p>
<ul>
  <li>Parentì˜ fork()ê°’ =&gt; childì˜ pid ê°’</li>
  <li>Childì˜ fork()ê°’ =&gt; 0</li>
</ul>

<p>ê·¸ëŸ¬ë‚˜! Schedulerê°€ ë¶€ëª¨ë¥¼ ë¨¼ì € ìˆ˜í–‰í• ì§€ ì•„ë‹ì§€ í™•ì‹ í•  ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´ ì¶œë ¥ë  ìˆ˜ ìˆë‹¤.(parentì™€ childì˜ ìˆœì„œëŠ” non-deterministicí•¨. ì¦‰, í™•ì‹ í•  ìˆ˜ ì—†ìŒ. schedulerê°€ ê²°ì •í•˜ëŠ” ì¼ì„.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> --><td class="rouge-code"><pre>pid : 29146
child (pid : 29147)
parent of 29147 (pid : 29146)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="wait"><strong>wait</strong></h3>

<p><strong>ì½”ë“œ</strong></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td> --><td class="rouge-code"><pre><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/wait.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"pid : %d"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">getpid</span><span class="p">());</span> <span class="c1">// pid : 29146</span>
    
    <span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>					<span class="c1">// ì£¼ëª©</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>									<span class="c1">// (1) fork ì‹¤íŒ¨</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>					<span class="c1">// (2) child ì¸ ê²½ìš° (fork ê°’ì´ 0)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"child (pid : %d)"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">getpid</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>								<span class="c1">// (3) parent case</span>
        <span class="kt">int</span> <span class="n">wc</span> <span class="o">=</span> <span class="n">wait</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>				<span class="c1">// ì¶”ê°€ëœ ë¶€ë¶„</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"parent of %d (wc : %d / pid : %d)"</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">getpid</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ê²°ê³¼</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> --><td class="rouge-code"><pre>pid : 29146
child (pid : 29147)
parent of 29147 (wc : 29147 / pid : 29146)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>waitë¥¼ í†µí•´ì„œ, childì˜ ì‹¤í–‰ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤Œ. parentê°€ ë¨¼ì € ì‹¤í–‰ë˜ë”ë¼ë„, wait ()ëŠ” childê°€ ëë‚˜ê¸° ì „ì—ëŠ” returní•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ë°˜ë“œì‹œ childê°€ ë¨¼ì € ì‹¤í–‰ë¨.</p>

<h3 id="exec"><strong>exec</strong></h3>

<blockquote>
  <p>ë‹¨ìˆœ forkëŠ” ë™ì¼í•œ í”„ë¡œì„¸ìŠ¤ì˜ ë‚´ìš©ì„ ì—¬ëŸ¬ ë²ˆ ë™ì‘í•  ë•Œ ì‚¬ìš©í•¨.</p>

  <p>childì—ì„œëŠ” parentì™€ ë‹¤ë¥¸ ë™ì‘ì„ í•˜ê³  ì‹¶ì„ ë•ŒëŠ” execë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.</p>
</blockquote>

<p><strong>ì½”ë“œ</strong></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td> --><td class="rouge-code"><pre><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/wait.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"pid : %d"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">getpid</span><span class="p">());</span> <span class="c1">// pid : 29146</span>
    
    <span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>					<span class="c1">// ì£¼ëª©</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>									<span class="c1">// (1) fork ì‹¤íŒ¨</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>					<span class="c1">// (2) child ì¸ ê²½ìš° (fork ê°’ì´ 0)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"child (pid : %d)"</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">getpid</span><span class="p">());</span>
        <span class="kt">char</span> <span class="o">*</span><span class="n">myargs</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
        <span class="n">myargs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="s">"wc"</span><span class="p">);</span>		<span class="c1">// ë‚´ê°€ ì‹¤í–‰í•  íŒŒì¼ ì´ë¦„</span>
        <span class="n">myargs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="s">"p3.c"</span><span class="p">);</span>		<span class="c1">// ì‹¤í–‰í•  íŒŒì¼ì— ë„˜ê²¨ì¤„ argument</span>
        <span class="n">myargs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>				<span class="c1">// end of array</span>
        <span class="n">execvp</span><span class="p">(</span><span class="n">myarges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">myargs</span><span class="p">);</span>		<span class="c1">// wc íŒŒì¼ ì‹¤í–‰.</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"this shouldn't print out"</span><span class="p">)</span> <span class="c1">// ì‹¤í–‰ë˜ì§€ ì•ŠìŒ. **ì¤‘ìš”**</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>								<span class="c1">// (3) parent case</span>
        <span class="kt">int</span> <span class="n">wc</span> <span class="o">=</span> <span class="n">wait</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span>				<span class="c1">// ì¶”ê°€ëœ ë¶€ë¶„</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"parent of %d (wc : %d / pid : %d)"</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">getpid</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ê²°ê³¼</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> --><td class="rouge-code"><pre>pid : 29146
child (pid : 29147)
parent of 29147 (wc : 29147 / pid : 29146)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>execê°€ ì‹¤í–‰ë˜ë©´,</p>

<p>execvp( ì‹¤í–‰ íŒŒì¼, ì „ë‹¬ ì¸ì ) í•¨ìˆ˜ëŠ”, code segment ì˜ì—­ì— ì‹¤í–‰ íŒŒì¼ì˜ ì½”ë“œë¥¼ ì½ì–´ì™€ì„œ ë®ì–´ ì”Œìš´ë‹¤.</p>

<p>ì”Œìš´ ì´í›„ì—ëŠ”, heap, stack, ë‹¤ë¥¸ ë©”ëª¨ë¦¬ ì˜ì—­ì´ ì´ˆê¸°í™”ë˜ê³ , OSëŠ” ê·¸ëƒ¥ ì‹¤í–‰í•œë‹¤. ì¦‰, ìƒˆë¡œìš´ Processë¥¼ ìƒì„±í•˜ì§€ ì•Šê³ , í˜„ì¬ í”„ë¡œê·¸ë¨ì— wcë¼ëŠ” íŒŒì¼ì„ ì‹¤í–‰í•œë‹¤. ê·¸ë¡œì¸í•´ì„œ, execvp() ì´í›„ì˜ ë¶€ë¶„ì€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<p>exec ê³„ì—´ì€ ë³µì‚¬ê°€ ì•„ë‹Œ ë®ì–´ì“°ê¸°ë¼ê³  ë³´ë©´ ëœë‹¤.</p>
:ET