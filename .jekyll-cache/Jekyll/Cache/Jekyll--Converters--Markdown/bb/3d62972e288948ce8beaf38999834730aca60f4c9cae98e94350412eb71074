I"v<h1 id="spring-jpa">Spring JPA</h1>
<hr />

<h2 id="-jpa">💿 JPA</h2>

<p><img src="https://gmlwjd9405.github.io/images/spring-framework/spring-jpa-architecture.png" alt="image" /></p>

<blockquote>
  <p>자바 어플리케이션에서 관계형 데이터베이스를 사용하는 방식을 정의한 인터페이스</p>
</blockquote>

<p><strong>여기서 주목할 점은 바로 인터페이스라는 것이다</strong>. JPA는 특정 기능을 하는 라이브러리가 아니다. JPA는 자바 어플리케이션에서 관계형 데이터베이스를 어떻게 사용해야 하는지를 정의한 방법이다.</p>

<p><strong>JPA는 단순히 interface이기 때문에 구현이 없다.</strong> JPA를 정의한 javax.persistence 패키지의 대부분은 각종 Annotation 과 interface, enum, Exception으로 이루어져 있다. JPA의 핵심이 되는 EntityManager는 아래와 같이  javax.persistence.EntityManager라는 파일에 interface로 정의되어 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">javax.persistence</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">...</span>
<span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">EntityManager</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">persist</span><span class="o">(</span><span class="nc">Object</span> <span class="n">entity</span><span class="o">);</span>

    <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">merge</span><span class="o">(</span><span class="no">T</span> <span class="n">entity</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Object</span> <span class="n">entity</span><span class="o">);</span>

    <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">find</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">entityClass</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">primaryKey</span><span class="o">);</span>

    <span class="c1">// More interface methods...</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="jpa의-3요소">JPA의 3요소</h3>

<ol>
  <li>javax.persistance 패키지로 정의된 API 그 자체</li>
  <li>JPQL(Java Persistence Query Language)</li>
  <li>객체/관계 메타데이터
___</li>
</ol>

<h2 id="-hibernate">💿 Hibernate</h2>

<blockquote>
  <p>hibernate는 JPA의 구현체</p>
</blockquote>

<p><img src="https://suhwan.dev/images/jpa_hibernate_repository/jpa_hibernate_relationship.png" alt="image" /></p>

<p>EntityManagerFactory, EntityManager, EntityTransaction을 Hibernate에서는 각각 SessionFactory, Session, Transaction으로 상속받고 각각 Impl로 구현한 것이다.</p>

<p><strong>즉, JPA를 사용하기 위해서 반드시 hibernate를 사용할 필요가 없다.</strong></p>

<h3 id="hibernate-구조">Hibernate 구조</h3>

<p><img src="https://gmlwjd9405.github.io/images/spring-framework/spring-hibernate-architecture.png" alt="image" /></p>

<ol>
  <li><strong>Configurattion</strong>
    <ul>
      <li>Session Factory에서 Java Application 및 Database와 함께 작업할 때 사용</li>
      <li>It represents an entire set of mappings of an application Java Types to an SQL database.</li>
    </ul>
  </li>
  <li><strong>Session Factory</strong>
    <ul>
      <li>사용자 어플리케이션에서 Session Factory에 Session 객체를 요청하면 Session Factory는 Configuration 정보를 사용하여 Session Object를 인스턴스화 한다.</li>
    </ul>
  </li>
  <li><strong>Session</strong>
    <ul>
      <li>응용 프로그램과 데이터베이스 간의 상호작용을 나타낸다.(항시적으로)세션의 인스턴스는 SessionFactory Bean으로 부터 발생</li>
      <li>Session 객체는 application 과  데이터베이스(데이터가 저장 된)의 인터페이스이다.짧은 생존주기를 가지고 있으며, JDBC Connection 을 포장 하고 있다. (쿼리를 직접적으로 수행하는 것 같다. 그래서 생존주기(트랜잭션??)가 짧으며, JDBC Connection 을 포장한다는 표현을 한 것 같다.)</li>
      <li>Session, EntityManager 같은 것들이 Persistent Context라고 부른다. 그릭</li>
    </ul>
  </li>
  <li><strong>Query</strong>
    <ul>
      <li>응용프로그램이 하나 이상의 저장된 객체(Persistence Object)에 대해 데이터베이스를 쿼리할 수 있게한다.</li>
    </ul>
  </li>
  <li><strong>First-level cache</strong>
    <ul>
      <li>데이터베이스와 상호 작용하는 동안 Hibernate Session 객체가 사용하는 기본 캐시를 나타낸다. Session cache라고도 하며, 현재 세션 내에서 객체를 현제 Session에 저장한다. Session에 저장된 객체에서 DB에 하는 모든 요청은 Session cache를 거친다. Session 객체가 활성중일 때만 Session cache를 사용할 수 있다.</li>
    </ul>
  </li>
  <li><strong>Transaction</strong>
    <ul>
      <li>데이터의 영속성을 달성시키고(commit) 예기치 못한 상황이 발생할 경우 롤백할 수 있게한다.</li>
    </ul>
  </li>
  <li><strong>Persistent objects</strong>
    <ul>
      <li>Persistent objects는 관계형 데이터베이스의 한 필드로서 유지되는 평범한 오래된 Java 객체들(POJOs)이다.</li>
      <li>구성 파일(hibernate.cfg.xml 또는 hybernate.properties)에서 구성하거나 @Entity 어노테이션으로 선언될 수 있다.</li>
    </ul>
  </li>
  <li><strong>Second-level-cache</strong> :
    <ul>
      <li>여러 세션에 걸쳐 객체를 저장하는 데 사용된다(application 단위의 cache).</li>
      <li>Second-level-cache는 명시적으로 사용되며, 해당 캐시에 대한 캐시 공급자를 제공해야 한다.</li>
      <li>일반적인  Second-level-cache 공급자 중 하나로 EhCache가 있다.</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="-spring-data">💿 Spring-Data</h2>

<p><img src="https://suhwan.dev/images/jpa_hibernate_repository/overall_design.png" alt="image" /></p>

<blockquote>
  <p>Spring에서 제공하는 모듈 중 하나로 개발자가 더 쉽게 사용할 수 있도록 JPA를 한단계 더 추상화 시킨 Repository라는 interface를 제공</p>
</blockquote>

<p><strong>즉, Spring-Data-JPA의 Repository의 내부적인 구현에서 JPA를 사용한다는 뜻</strong></p>

<hr />

<h2 id="-jdbc">💿 JDBC</h2>

<blockquote>
  <p>Java Database Connectivity의 줄임말. java에서 DB에 접속할 수 있도록 하는 API</p>
</blockquote>

<p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=http%3A%2F%2Fcfile27.uf.tistory.com%2Fimage%2F992473455ACDBAD8118620" alt="image" /></p>

<ul>
  <li>JDBC Driver Manager는 DB에 맞는 Driver를 load하여 JDBC를 초기화 합니다</li>
  <li>JDBC Driver들은 Java App의 요청들을 DBMS가 이해 할 수 있는 Protocal로 변환합니다.</li>
</ul>

<p><img src="https://gmlwjd9405.github.io/images/spring-framework/spring-jdbc-architecture.png" alt="image" /></p>
:ET