I"á:<h1 id="tensorflow2"><strong>Tensorflow2</strong></h1>
<hr />

<h2 id="ê°œë°œ-ë°°ê²½">ê°œë°œ ë°°ê²½</h2>

<blockquote>
  <p>Tensorflow1ì˜ ê³„ì‚° ê·¸ë˜í”„(ì„¸ì…˜) ì‚¬ìš©ì˜ ë³µì¡ì„±</p>
  <ul>
    <li>ì†ë„ ì§ê´€ì„± ë©´ì—ì„œ ëª¨ë‘ ë–¨ì–´ì§</li>
    <li>Kerasê°€ ì‚¬ìš©ì„±ì„ ë†’ì—¬ì£¼ë‚˜, ë³´ë‹¤ ìœ ê¸°ì  ê²°í•© í•„ìš”</li>
  </ul>
</blockquote>

<h2 id="ecosystem">Ecosystem</h2>

<p><img src="https://i0.wp.com/rubikscode.net/wp-content/uploads/2019/04/TFarch-2.jpg?w=672&amp;ssl=1" alt="Image" /></p>

<h2 id="ë³€í™”ì™€-íŠ¹ì§•">ë³€í™”ì™€ íŠ¹ì§•</h2>

<ul>
  <li>API ê°„ì†Œí™” ë° ì •ë¦¬
    <ul>
      <li>ì‚¬ë¼ì§„ ì£¼ìš” API
        <ul>
          <li>Session</li>
          <li>control_dependencies, global_variables_initializer</li>
        </ul>
      </li>
      <li>1.x ë²„ì „ í˜¸í™˜ APIë„ tf.compat.v1.Session()</li>
    </ul>
  </li>
  <li>ì¦‰ì‹œ ì‹¤í–‰ ëª¨ë“œ(eager execution): ê¸°ë³¸ ëª¨ë“œ
    <ul>
      <li>ê·¸ë˜í”„ ìƒì„± ì—†ì´ í…ì„œ ê°’ ê³„ì‚° ê°€ëŠ¥ -&gt; ì—°ì‚° ê°’ ë°”ë¡œ í™•ì¸ ê°€ëŠ¥</li>
      <li>Numpy ì™€ ìœ ì‚¬</li>
    </ul>
  </li>
  <li>Session ëŒ€ì‹  tf.function ë°ì½”ë ˆì´í„°</li>
  <li>tf.keras
    <ul>
      <li>ê³ ìˆ˜ì¤€ API ë¬¸ë²•ì„ ì¼€ë¼ìŠ¤ ê¸°ë°˜ì˜ tf.kerasë¡œ í†µì¼</li>
    </ul>
  </li>
  <li>TPU ì§€ì›
    <ul>
      <li>ë¨¸ì‹ ëŸ¬ë‹ê³¼ ë”¥ëŸ¬ë‹ì„ ìœŸë‚˜ í•˜ë“œì›¨ì–´</li>
    </ul>
  </li>
</ul>

<h2 id="tfkeras">tf.keras</h2>

<ul>
  <li>ì£¼ìš” í•˜ìœ„ ëª¨ë“ˆ
    <ul>
      <li>dataset: ë°ì´í„° ì…‹</li>
      <li>models: ëª¨ë¸ ìƒì„± ë° ëª¨ë¸ ê´€ë ¨ API</li>
      <li>metrics: í‰ê°€ ì¸¡ì • ê´€ë ¨ API</li>
      <li>losses: ì†ì‹¤ ê´€ë ¨ API</li>
      <li>callback: ì½œë°± ì²˜ë¦¬</li>
      <li>ê¸°íƒ€ Keras ëª¨ë“ˆ: estimator, optimizer, layers, â€¦</li>
    </ul>
  </li>
  <li>ì£¼ìš” í´ë˜ìŠ¤
    <ul>
      <li>Model: ê³„ì¸µì„ í•œ ê°ì²´ë¡œ ê·¸ë£¹í™” í•œ ê²ƒ</li>
      <li>Sequential: ê³„ì¸µì˜ ì„ í˜• ìŠ¤íƒ</li>
    </ul>
  </li>
  <li>ì£¼ìš” í•¨ìˆ˜
    <ul>
      <li>Input(): Keras í…ì„œë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”</li>
    </ul>
  </li>
</ul>

<h2 id="ì˜ˆì œ-ì½”ë“œ">ì˜ˆì œ ì½”ë“œ</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="rouge-code"><pre><span class="n">mnist</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">datasets</span><span class="p">.</span><span class="n">mnist</span>

<span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">mnist</span><span class="p">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span> <span class="o">=</span> <span class="n">x_train</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="n">x_test</span> <span class="o">/</span> <span class="mf">255.0</span>

<span class="c1"># ì±„ë„ ì°¨ì›ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
</span><span class="n">x_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="p">[...,</span> <span class="n">tf</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="p">[...,</span> <span class="n">tf</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">train_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">(</span>
    <span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)).</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">10000</span><span class="p">).</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="n">test_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">Dataset</span><span class="p">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)).</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">MyModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">flatten</span> <span class="o">=</span> <span class="n">Flatten</span><span class="p">()</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">d1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">d2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">d1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">d2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>

<span class="n">loss_object</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">losses</span><span class="p">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">()</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">optimizers</span><span class="p">.</span><span class="n">Adam</span><span class="p">()</span>

<span class="n">train_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">metrics</span><span class="p">.</span><span class="n">Mean</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'train_loss'</span><span class="p">)</span>
<span class="n">train_accuracy</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">metrics</span><span class="p">.</span><span class="n">SparseCategoricalAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'train_accuracy'</span><span class="p">)</span>

<span class="n">test_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">metrics</span><span class="p">.</span><span class="n">Mean</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'test_loss'</span><span class="p">)</span>
<span class="n">test_accuracy</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">metrics</span><span class="p">.</span><span class="n">SparseCategoricalAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'test_accuracy'</span><span class="p">)</span>

<span class="o">@</span><span class="n">tf</span><span class="p">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">train_step</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
  <span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">tape</span><span class="p">:</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_object</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
  <span class="n">gradients</span> <span class="o">=</span> <span class="n">tape</span><span class="p">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">trainable_variables</span><span class="p">)</span>
  <span class="n">optimizer</span><span class="p">.</span><span class="n">apply_gradients</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">gradients</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">trainable_variables</span><span class="p">))</span>

  <span class="n">train_loss</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
  <span class="n">train_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

<span class="o">@</span><span class="n">tf</span><span class="p">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">test_step</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
  <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
  <span class="n">t_loss</span> <span class="o">=</span> <span class="n">loss_object</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

  <span class="n">test_loss</span><span class="p">(</span><span class="n">t_loss</span><span class="p">)</span>
  <span class="n">test_accuracy</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

<span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">EPOCHS</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">train_ds</span><span class="p">:</span>
    <span class="n">train_step</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span> <span class="ow">in</span> <span class="n">test_ds</span><span class="p">:</span>
    <span class="n">test_step</span><span class="p">(</span><span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>

  <span class="n">template</span> <span class="o">=</span> <span class="s">'ì—í¬í¬: {}, ì†ì‹¤: {}, ì •í™•ë„: {}, í…ŒìŠ¤íŠ¸ ì†ì‹¤: {}, í…ŒìŠ¤íŠ¸ ì •í™•ë„: {}'</span>
  <span class="k">print</span> <span class="p">(</span><span class="n">template</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">train_loss</span><span class="p">.</span><span class="n">result</span><span class="p">(),</span>
                         <span class="n">train_accuracy</span><span class="p">.</span><span class="n">result</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span>
                         <span class="n">test_loss</span><span class="p">.</span><span class="n">result</span><span class="p">(),</span>
                         <span class="n">test_accuracy</span><span class="p">.</span><span class="n">result</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>
:ET